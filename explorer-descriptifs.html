<!DOCTYPE html>
<html lang="fr" class="bg-gray-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorateur de Descriptifs - AnalyzTech</title>
    
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- D3.js via CDN for charting -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Text highlighting styles */
        .highlight {
            background-color: #fef08a; /* Tailwind yellow-200 */
            padding: 0.1em 0.3em;
            border-radius: 0.2em;
        }
        .highlight-found {
            background-color: #bbf7d0; /* Tailwind green-200 */
        }
        .highlight-not-found {
            background-color: #fecaca; /* Tailwind red-200 */
        }

        /* Custom spinner for loading overlay */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #ffffff;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Chart-specific styles */
        .chart-container {
            width: 100%;
            height: 400px;
            background-color: #fff;
            border-radius: 0.5em;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1.5em 1em;
        }
        .chart-container svg {
            width: 100%;
            height: 100%;
        }
        .axis text {
            font-size: 0.8em;
            fill: #4b5563;
        }
        .axis line, .axis path {
            stroke: #d1d5db;
            shape-rendering: crispEdges;
        }
        .line-daily {
            fill: none;
            stroke: #3b82f6;
            stroke-width: 2px;
        }
        .line-trend {
            fill: none;
            stroke: #f97316;
            stroke-width: 2px;
            stroke-dasharray: 5,5;
        }
        .dot {
            fill: #3b82f6;
            stroke: #fff;
            stroke-width: 1.5px;
        }
        .tooltip {
            position: absolute;
            text-align: center;
            padding: 0.5em;
            background: rgba(17, 24, 39, 0.8);
            color: #fff;
            border-radius: 0.375rem;
            pointer-events: none;
            font-size: 0.8em;
            transition: opacity 0.2s;
        }
        .average-line {
            stroke: #16a34a;
            stroke-width: 2px;
            stroke-dasharray: 2,2;
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-60 z-50 flex flex-col items-center justify-center">
        <div class="spinner"></div>
        <p class="text-white mt-4 font-semibold">Chargement des donn√©es...</p>
    </div>

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div>
                    <a href="descriptif.html" class="text-blue-600 hover:text-blue-800 text-sm mb-2 inline-block">‚Üê Retour aux statistiques</a>
                    <h1 class="text-2xl font-bold text-gray-900">Explorateur de Descriptifs Sommaires</h1>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">
        
        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column: Summary -->
            <div id="summary" class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg space-y-3">
                <h2 class="text-xl font-semibold text-gray-800 border-b pb-3 mb-3">R√©sum√© Global</h2>
                <p id="total-records" class="text-sm text-gray-600"></p>
                <p id="unique-users" class="text-sm text-gray-600 font-medium"></p>
                <p id="unique-operations" class="text-sm text-gray-600 font-medium"></p>
                <hr class="my-3">
                <p id="score-stats" class="text-sm text-gray-600"></p>
                <p id="high-quality" class="text-sm text-gray-600"></p>
                <p id="medium-quality" class="text-sm text-gray-600"></p>
                <p id="low-quality" class="text-sm text-gray-600"></p>
                <hr class="my-3">
                <div class="bg-green-50 p-3 rounded-lg">
                    <p id="avg-score" class="text-sm font-bold text-green-800"></p>
                </div>
            </div>

            <!-- Right Column: Quick Filters -->
            <div id="filters-section" class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-semibold text-gray-800 border-b pb-3 mb-4">Filtres rapides</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <!-- Filter by quality -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Filtrer par qualit√©</label>
                        <select id="quality-filter" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="all">Tous</option>
                            <option value="high">√âlev√©e (‚â•70%)</option>
                            <option value="medium">Moyenne (30-70%)</option>
                            <option value="low">Faible (<30%)</option>
                        </select>
                    </div>
                    
                    <!-- Filter by agency -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Filtrer par agence</label>
                        <select id="agency-filter" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="all">Toutes les agences</option>
                        </select>
                    </div>

                    <!-- Sort by -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Trier par</label>
                        <select id="sort-by" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="date-desc">Date (plus r√©cent)</option>
                            <option value="date-asc">Date (plus ancien)</option>
                            <option value="score-desc">Score (d√©croissant)</option>
                            <option value="score-asc">Score (croissant)</option>
                        </select>
                    </div>
                </div>
                <button id="reset-filters" class="px-4 py-2 text-sm text-gray-600 hover:text-gray-900 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                    R√©initialiser les filtres
                </button>
            </div>
        </div>

        <!-- Chart Section -->
        <div class="bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-xl font-semibold text-gray-800 border-b pb-3 mb-4">Taux de Similarit√© Quotidien</h2>
            <div class="chart-container">
                <svg id="daily-similarity-chart"></svg>
            </div>
            <div class="text-xs mt-3 flex justify-center gap-4 text-gray-600">
                <span class="flex items-center"><span class="w-3 h-1.5 rounded-full bg-blue-500 mr-2"></span>Moy. Quotidienne</span>
                <span class="flex items-center"><span class="w-3 h-0.5 border-t-2 border-dashed border-orange-500 mr-2"></span>Tendance (7j)</span>
                <span class="flex items-center"><span class="w-3 h-0.5 border-t-2 border-dotted border-green-600 mr-2"></span>Moy. Globale</span>
            </div>
        </div>

        <!-- User Tables -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <section id="best-users-section" class="bg-white p-6 rounded-xl shadow-lg">
                 <h2 class="text-xl font-semibold text-gray-800 border-b pb-3 mb-3">üèÜ Meilleurs Utilisateurs (>70%)</h2>
                 <div id="best-users-table" class="overflow-x-auto"></div>
            </section>
            <section id="low-score-users-section" class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-semibold text-gray-800 border-b pb-3 mb-3">üìâ Utilisateurs √† Am√©liorer (<30%)</h2>
                <div id="low-score-users-table" class="overflow-x-auto"></div>
            </section>
        </div>
        
        <!-- Record Details Section -->
        <section id="record" class="bg-white p-6 rounded-xl shadow-lg">
            <div class="flex flex-wrap gap-4 justify-between items-center border-b pb-4 mb-4">
                 <h2 class="text-xl font-semibold text-gray-800">Explorateur d'Enregistrements</h2>
                 <div class="flex flex-wrap items-center gap-x-4 gap-y-2">
                    <input type="text" id="search-contract" placeholder="Rechercher contrat..." class="p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm">
                    <button id="search-button" class="px-4 py-2 bg-teal-600 text-white font-semibold rounded-lg hover:bg-teal-700 transition">Rechercher</button>
                    <input type="text" id="search-email" placeholder="Rechercher email..." class="p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                    <button id="search-email-button" class="px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition">Rechercher</button>
                 </div>
            </div>

            <div class="flex justify-center gap-4 my-4">
                <button id="prev" class="px-5 py-2 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 transition disabled:opacity-50 disabled:cursor-not-allowed">‚Üê Pr√©c√©dent</button>
                <span id="record-counter" class="px-5 py-2 text-gray-700 font-medium">-</span>
                <button id="next" class="px-5 py-2 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 transition disabled:opacity-50 disabled:cursor-not-allowed">Suivant ‚Üí</button>
            </div>
            
            <div class="bg-gray-50 p-4 rounded-lg grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 text-sm mb-6">
                <div><strong class="block text-gray-500">Contrat:</strong> <span id="rec-contract" class="font-mono text-xs break-all"></span></div>
                <div><strong class="block text-gray-500">Agence:</strong> <span id="rec-agency" class="font-mono"></span></div>
                <div><strong class="block text-gray-500">Email:</strong> <span id="rec-email" class="font-mono text-xs break-all"></span></div>
                <div><strong class="block text-gray-500">Date:</strong> <span id="rec-date" class="font-mono text-xs"></span></div>
                <div><strong class="block text-gray-500">Score:</strong> <span id="rec-score" class="font-mono text-lg font-bold"></span></div>
            </div>

            <div class="mb-6">
                <div class="flex items-center justify-between mb-2">
                    <h4 class="text-lg font-semibold text-gray-700">Analyse de similarit√©</h4>
                    <div class="text-sm text-gray-600">
                        <span id="rec-matches" class="font-mono font-semibold"></span>
                    </div>
                </div>
                <div class="bg-gray-50 p-3 rounded-md">
                    <div class="flex items-center gap-2">
                        <div class="flex-1 bg-gray-200 rounded-full h-4 overflow-hidden">
                            <div id="score-bar" class="h-full transition-all duration-500" style="width: 0%;"></div>
                        </div>
                        <span id="score-percentage" class="text-sm font-semibold text-gray-700">0%</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Cette barre indique le pourcentage de segments du descriptif original retrouv√©s dans le r√©sultat IA</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div>
                    <h4 class="text-lg font-semibold mb-2 text-gray-700">Description originale</h4>
                    <div id="desc-block" class="h-96 overflow-y-auto p-4 border rounded-md bg-white text-sm leading-relaxed"></div>
                </div>
                 <div>
                    <h4 class="text-lg font-semibold mb-2 text-gray-700">R√©sultat IA</h4>
                    <div id="ai-block" class="h-96 overflow-y-auto p-4 border rounded-md bg-white text-sm leading-relaxed"></div>
                </div>
            </div>
            
            <div>
                 <h4 class="text-lg font-semibold mb-2 text-gray-700">Segments test√©s (√©chantillon de 50)</h4>
                 <ul id="segments-list" class="max-h-64 overflow-y-auto space-y-2 text-sm"></ul>
            </div>
        </section>

    </main>

    <script src="explorer-descriptifs.js"></script>
</body>
</html>

